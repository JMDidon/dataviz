// Generated by CoffeeScript 1.6.1
(function(){$(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;$.ajaxSetup({async:!1});r=t=u=a=[];c=$("#sidebar-wrapper");i=$("#sidebar-filter");v=$("#sidebar-toggler");s=function(e,t,n){return e.filter(function(e,r){return e[t]===n})};p=function(e,t){return setTimeout(t,e)};e=function(e){return'<li class="sidebar-item-blazon"><strong><label><input type="checkbox" id="blazon_'+e.i+'" class="sidebar-check-blazon">'+e.name+"</label></strong><ul></ul></li>"};n=function(e){return'<li class="sidebar-item-char"><label><input type="checkbox" id="char_'+e.i+"_"+e.j+'" class="sidebar-check-char" data-name="'+e.name+'">'+e.name+"</label></li>"};h=function(){var e,n,i,s,o,u;t.sort(function(e,t){return e.name>t.name});for(i=0,o=t.length;i<o;i++){e=t[i];e.characters=[];for(s=0,u=r.length;s<u;s++){n=r[s];n.blazon===e.name&&e.characters.push(n)}e.characters.sort(function(e,t){return e.name>t.name})}return t=t.filter(function(e,t){return e.characters.length})};m=function(){var r,i,s,o,u,a,f,l,h,p,d;d=[];for(o=a=0,l=t.length;a<l;o=++a){r=t[o];i=$(e({i:o,name:r.name}));p=r.characters;for(u=f=0,h=p.length;f<h;u=++f){s=p[u];$(n({i:o,j:u,name:s.name})).appendTo(i.children("ul"))}d.push(i.appendTo(c))}return d};o=function(){var e,t,n,r,i,o;for(n in a){i=a[n];if(typeof i!="object")continue;r=s(u,"name",i.name);if(!r.length)continue;delete r[0].name;delete r[0].find;i.moves=function(){var n,i;n=r[0];i=[];for(e in n){t=n[e];i.push(t)}return i}()}o=[];for(n in a){i=a[n];o.push(i)}return o};f=function(){var e;$(".sidebar-check-blazon").on("change",function(){var e;e=$(this).is(":checked");return $(this).parents(".sidebar-item-blazon").find("input").not(this).each(function(){this.checked=e;return $(this).change()})});e=!1;return $(".sidebar-check-char").on("change",function(){var n,r,i,s;s=$(this).parents(".sidebar-item-blazon");n=s.find(".sidebar-check-blazon");r=s.find(".sidebar-check-char");$(this).is(":not(:checked)")&&n.attr("checked",!1);n.is(":not(:checked)")&&r.filter(":checked").length===r.length&&n.click();i=$(this).attr("id").match(/char_([0-9]+)_([0-9]+)/);$(this).is(":checked")?a[$(this).attr("id")]=t[parseInt(i[1])].characters[parseInt(i[2])]:delete a[$(this).attr("id")];clearTimeout(e);return e=p(50,function(){return console.log(o())})})};l=function(){return i.on("keyup",function(){var e;e=this.value.toLowerCase();return $(".sidebar-check-char").each(function(){var t;t=$(this).parents(".sidebar-item-char");return this.dataset.name.toLowerCase().indexOf(e)>-1?t.slideDown():t.slideUp()})})};d=function(){var e;e=$(".sidebar-check-blazon:checked").length!==$(".sidebar-check-blazon").length;return $(".sidebar-check-blazon").each(function(){this.checked=e;return $(this).change()})};$.get("api/get/characters",function(e){return r=JSON.parse(e)});$.get("api/get/blazons",function(e){return t=JSON.parse(e)});$.get("api/get/moves",function(e){return u=JSON.parse(e)});h();m();f();l();v.on("click",d);return d()})}).call(this);