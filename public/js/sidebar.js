// Generated by CoffeeScript 1.6.1
(function(){$(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;$.ajaxSetup({async:!1});r=t=o=u=[];l=$("#sidebar-wrapper");i=$("#sidebar-filter");d=$("#sidebar-toggler");Array.prototype.find=function(e,t){return this.filter(function(n,r){return n[e]===t})};h=function(e,t){return setTimeout(t,e)};e=function(e){return'<li class="sidebar-item-blazon"><strong><label><input type="checkbox" id="blazon_'+e.i+'" class="sidebar-check-blazon">'+e.name+"</label></strong><ul></ul></li>"};n=function(e){return'<li class="sidebar-item-char"><label><input type="checkbox" id="char_'+e.i+"_"+e.j+'" class="sidebar-check-char" data-name="'+e.name+'">'+e.name+"</label></li>"};c=function(){var e,n,i,s,o,u;t.sort(function(e,t){return e.name>t.name});for(i=0,o=t.length;i<o;i++){e=t[i];e.characters=[];for(s=0,u=r.length;s<u;s++){n=r[s];n.blazon===e.name&&e.characters.push(n)}e.characters.sort(function(e,t){return e.name>t.name})}return t=t.filter(function(e,t){return e.characters.length})};v=function(){var r,i,s,o,u,a,f,c,h,p,d;d=[];for(o=a=0,c=t.length;a<c;o=++a){r=t[o];i=$(e({i:o,name:r.name}));p=r.characters;for(u=f=0,h=p.length;f<h;u=++f){s=p[u];$(n({i:o,j:u,name:s.name})).appendTo(i.children("ul"))}d.push(i.appendTo(l))}return d};s=function(){var e,t,n,r,i;for(i in u){n=u[i];if(typeof n!="object")continue;r=o.find("name",n.name);if(!r.length)continue;delete r[0].name;delete r[0].find;n.moves=function(){var n,i;n=r[0];i=[];for(e in n){t=n[e];i.push(t)}return i}()}return u};a=function(){var e;$(".sidebar-check-blazon").on("change",function(){var e;e=$(this).is(":checked");return $(this).parents(".sidebar-item-blazon").find("input").not(this).each(function(){this.checked=e;return $(this).change()})});e=!1;return $(".sidebar-check-char").on("change",function(){var n;$(this).is(":not(:checked)")&&$(this).parents(".sidebar-item-blazon").find(".sidebar-check-blazon").attr("checked",!1);n=$(this).attr("id").match(/char_([0-9]+)_([0-9]+)/);$(this).is(":checked")?u[$(this).attr("id")]=t[parseInt(n[1])].characters[parseInt(n[2])]:delete u[$(this).attr("id")];clearTimeout(e);return e=h(50,function(){return console.log(s())})})};f=function(){return i.on("keyup",function(){var e;e=this.value.toLowerCase();return $(".sidebar-check-char").each(function(){var t;t=$(this).parents(".sidebar-item-char");return this.dataset.name.toLowerCase().indexOf(e)>-1?t.slideDown():t.slideUp()})})};p=function(){var e;e=$(".sidebar-check-blazon:checked").length!==$(".sidebar-check-blazon").length;return $(".sidebar-check-blazon").each(function(){this.checked=e;return $(this).change()})};$.get("api/get/characters",function(e){return r=JSON.parse(e)});$.get("api/get/blazons",function(e){return t=JSON.parse(e)});$.get("api/get/moves",function(e){return o=JSON.parse(e)});c();v();a();f();d.on("click",p);return p()})}).call(this);